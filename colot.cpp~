#include<opencv2/core/core.hpp>
#include<opencv2/highgui/highgui.hpp>
#include<opencv2/imgproc/imgproc.hpp>
#include<iostream>
#include<stdio.h>
using namespace cv;
using namespace std;

int main()
{

	Mat img,imgt,imgb;
	//img=imread("paul.jpg");
	//resize(img,img,Size(530,360));
	VideoCapture cap(0);
	system("mplayer intro.mp3");
	namedWindow("Color");
	static int bl=0,gl=0,rl=59,bh=28,gh=24,rh=255;
	vector < vector < Point > >contours;
	int count=0;
	int flag=0;
	for(;;)
	{
		count++;
		cap>>img;
		flip(img,img,1);
		createTrackbar("BL","Color",&bl,255);
		createTrackbar("GL","Color",&gl,255);
		createTrackbar("RL","Color",&rl,255);
				
		createTrackbar("BH","Color",&bh,255);
		createTrackbar("GH","Color",&gh,255);
		createTrackbar("RH","Color",&rh,255);
		
		inRange(img,Scalar(bl,gl,rl),Scalar(bh,gh,rh),imgt);
		imshow("mask",imgt);
		findContours (imgt, contours, CV_RETR_EXTERNAL,CV_CHAIN_APPROX_NONE);//cause of unhandled exceptions
		cvtColor(imgt,imgt,CV_GRAY2BGR);


		for(int i=0;i<contours.size();i++)
					{
		 				if(contourArea(contours[i])>30)//to eliminate noise contours
			 				{
								drawContours (imgt, contours, -1, Scalar(0,200,200), 2);
								//drawContours (mask, contours, -1, color, 2);
							 }
						 
		 
					}
		int max=90,maxi=-10;
		vector<Rect> boundRect( contours.size() );
		for(int i=0;i<contours.size();i++)
					{
						 boundRect[i] = boundingRect( contours[i] );
					}
		for(int i=0;i<boundRect.size();i++)
					{
						if(boundRect[i].width*boundRect[i].height>max)
						 {
							max=boundRect[i].width*boundRect[i].height;
							maxi=i;
						 }
						//drawContours (imgt, contours2, -1, Scalar(0,255,0), 2);
						//drawContours (img, contours2, -1, Scalar(0,255,0), 2);
            
						//drawContours (draw, contours2[maxi], -1, Scalar(255,255,255), 4);
						//rectangle( draw, boundRect[maxi].tl(), boundRect[maxi].br(), Scalar(0,255,255),2,0);
			 
					}
		
		if(max>90 && maxi>=0)
					{
						if(flag==0)
						{
							system("mplayer yes.mp3");
							flag=1;
						}
						//cout<<"largest rect index is "<<maxi<<"\n";
						//cout<<"largest rect area is "<<max<<"\n";
						rectangle(img,boundRect[maxi],Scalar(0,255,255),3,8);
						rectangle(imgt,boundRect[maxi],Scalar(0,255,255),3,8);
						
	
						putText(img,"Tracked",Point(boundRect[maxi].x,boundRect[maxi].y),FONT_HERSHEY_TRIPLEX,1.5,Scalar(0,250,255),1.5);
						//rectangle(imgt,boundRect[maxi],Scalar(0,255,255),3,8);
						putText(imgt,"Tracked",Point(boundRect[maxi].x,boundRect[maxi].y),FONT_HERSHEY_TRIPLEX,1.5,Scalar(0,250,255),1.5);

						Point trk_pnt=Point(boundRect[maxi].x+boundRect[maxi].width/2,boundRect[maxi].y+boundRect[maxi].height/2);

			    	    		//Point cursor=Point((boundRect[maxi].x)*1366/320,(boundRect[maxi].y)*768/480);
						circle(img,trk_pnt,2,Scalar(255,255,0),10);
						circle(imgt,trk_pnt,2,Scalar(255,255,0),10);				           	
						
						char text[10];
						int X=trk_pnt.x,Y=trk_pnt.y;
						sprintf(text, "X=%d // Y= %d",trk_pnt.x,trk_pnt.y);//to print a variable text on screen.
						putText(img,text,Point(10,30),FONT_HERSHEY_SIMPLEX,1,Scalar(250,250,250),2);		
						putText(imgt,text,Point(10,30),FONT_HERSHEY_SIMPLEX,1,Scalar(250,250,250),2);		
						
/*____________________________________________________Your Test Cases Here___________________________________________________________*/	
						if(count%100==0 && X<300 && Y==150)	
							{					
								system("mplayer track_l.mp3");
								count=0;
							}
						if(count%100==0 && X>300)	
							{					
								system("mplayer track_r.mp3");
								count=0;
							}
						/*if(count%100==0 && X>300)	
							{					
								system("mplayer track_r.mp3");
								count=0;
							}
						if(count%100==0 && X>300)	
							{					
								system("mplayer track_r.mp3");
								count=0;
							}*/
						

						
		

		
				}//end of if maxi>0 condition
			else
				{
					if(flag==0)
						{
							system("mplayer no.mp3");
							flag=1;
						}
				}
		imshow("Cam input",img);
		//imshow("Filter",imgt);
		//imshow("BCF",imgb);
		char c=waitKey(10);
		if(c=='b')
			break;
	}
	return 1;
			
	}
